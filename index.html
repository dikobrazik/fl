<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            html, body{
                width:100%;
                display: flex;
                flex-direction: row;
            }
            canvas{
                background-color: whitesmoke;
            }
            #hint{
                border: blueviolet solid 2px;
                border-radius: 20px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div>
            <canvas id="myCanvas" width=800 height=800>

            </canvas>
            <div id='hint'> 
                <p>
                    Подсказка
                </p>
            </div>
        </div>
        <script>
            var data = {
                parts:7,
                circles:[
                    {
                        radius:50,
                        qr:[
                            [
                                {
                                    n:7,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"black",
                                },
                                {
                                    n:7,
                                    color:"blue",
                                },
                                {
                                    n:5,
                                    color:"red",
                                },
                                {
                                    n:9,
                                    color:"purple",
                                },
                                {
                                    n:5,
                                    color:"black",
                                },
                                {
                                    n:7,
                                    color:"blue",
                                },
                                {
                                    n:5,
                                    color:"red",
                                },
                                {
                                    n:9,
                                    color:"purple",
                                },
                            ],
                            [],
                            [],
                            [
                                {
                                    n:0,
                                    color:"red",
                                },
                            ],
                        ]
                    },
                    {
                        radius:100,
                        qr:[
                            [
                                {
                                    n:10,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"purple",
                                },
                                {
                                    n:6,
                                    color:"orange",
                                },
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                                {
                                    n:10,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"purple",
                                },
                                {
                                    n:6,
                                    color:"orange",
                                },
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                                
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                            ],
                            [
                                {
                                    n:9,
                                    color:"green",
                                },
                                {
                                    n:4,
                                    color:"green",
                                },
                                {
                                    n:3,
                                    color:"green",
                                },
                                {
                                    n:"23",
                                    color:"green",
                                },
                            ],
                            [   {
                                    n:"5",
                                    color:"green",
                                },
                                {
                                    n:6,
                                    color:"green",
                                },
                                {
                                    n:7,
                                    color:"green",
                                },
                                {
                                    n:8,
                                    color:"green",
                                },
                            ],
                            [
                                {
                                    n:33,
                                    color:"green",
                                },
                                {
                                    n:4,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"green",
                                },
                                {
                                    n:3,
                                    color:"green",
                                },
                            ],
                        ]
                    },
                    {
                        radius:150,
                        qr:[
                            [
                                {
                                    n:6,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"green",
                                }
                            ],
                            [],
                            [],
                            [
                                {
                                    n:4,
                                    color:"red",
                                },
                                {
                                    n:8,
                                    color:"green",
                                },
                                {
                                    n:8,
                                    color:"purple",
                                },
                                {
                                    n:5,
                                    color:"green",
                                },
                                {
                                    n:9,
                                    color:"green",
                                },
                                {
                                    n:6,
                                    color:"red",
                                },
                            ],
                            [

                            ],
                            [
                                {
                                    n:6,
                                    color:"yellow",
                                },
                            ],
                            [
                                {
                                    n:6,
                                    color:"red",
                                },
                            ]
                        ]
                    }
                ],
            };
            
            const getContext = () => document.getElementById('myCanvas').getContext('2d');
            
            var shapes = [];
            var w=800, h =800;
            var leftOffset = document.getElementById('myCanvas').offsetLeft;
            var topOffset = document.getElementById('myCanvas').offsetTop;
            var ctx = getContext();

            const star = options =>{
                var starPath = new Path2D();
                if(options.size == 'small') r=4,R=8;
                else if(options.size == 'medium') r=5,R=10;
                else if(options.size == 'big') r=6,R=12;
                var ctx = getContext();
                if(options.color !== undefined) ctx.fillStyle = options.color;
                if(options.n != 0){
                    for(var i = 0,a = 0; i<2*options.n+1;i++,a += Math.PI / options.n){
                        var l = i % 2 == 0 ? r : R;
                        if(i==0){
                            starPath.moveTo(options.x + l * Math.cos(a),options.y + l * Math.sin(a));
                            continue;
                        }
                        starPath.lineTo(options.x + l * Math.cos(a),options.y + l * Math.sin(a));
                    };
                }else{
                    starPath.arc(options.x,options.y,r,0 * Math.PI, 2 * Math.PI)
                }
                //starPath.arc(options.x,options.y,R,0 * Math.PI, 2 * Math.PI)
                ctx.fill(starPath);
                shapes.push({
                    path:starPath,
                    hint:options.hint,
                });
                ctx.fillStyle = 'black';
            };
            
            
            init();
            function init(){
                ctx.clearRect(0,0,w,h)
                shapes = [];
                ctx.beginPath();
                var partDegree = 360/data.parts;
                for(var i = 0; i < data.parts; i++){
                    ctx.moveTo(w/2,h/2);
                    ctx.lineTo(
                        w/2+(data.circles[2].radius+20)*Math.sin((partDegree*i) * Math.PI / 180),
                        h/2+(data.circles[2].radius+20)*Math.cos((partDegree*i) * Math.PI / 180)
                    );
                };
                ctx.stroke();
                for(var i = 0; i<data.circles.length; i++){
                    var circle = data.circles[i];
                    var radius = i==0?0:data.circles[i-1].radius;
                    ctx.beginPath();
                    ctx.arc(w/2,h/2,circle.radius,0 * Math.PI, 2 * Math.PI)
                    ctx.stroke();
                    if(i==0) var delta = circle.radius;
                    else var delta = (circle.radius-data.circles[i-1].radius);
                    
                    for(var p = 0; p < data.parts; p++){
                        var part = circle.qr[p];
                        if(part === undefined) continue;
                        var ply = 1;
                        if(delta < 18){
                            data.circles[i].radius+=18;
                            //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                            return init();
                        }
                        if(i==0){
                            ply=2;
                            for(var k=0, num = ((24*180)/(Math.PI*(radius+12*ply)))/2;k<part.length;k++, num += ((16*180)/(Math.PI*(radius+12*ply)))){
                                if(num+5>partDegree){
                                    num=((12*180)/(Math.PI*(radius+16*ply)))/2;
                                    if(k==0 && i==0) {
                                        num=partDegree/2;
                                    }
                                    ply+=1.4;
                                }
                                if(20*ply > delta){
                                    data.circles[i].radius+=14;
                                    //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                                    return init();
                                }
                                if(k==0){
                                    x=w/2+(radius+16*ply)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                    y=h/2+(radius+16*ply)*Math.cos((num+partDegree*p) * Math.PI / 180);
                                }else if(ply>1){
                                    x=w/2+(radius+17*ply)*Math.sin((num+5+partDegree*p) * Math.PI / 180);
                                    y=h/2+(radius+17*ply)*Math.cos((num+5+partDegree*p) * Math.PI / 180);
                                }
                                star({
                                    n:part[k].n,
                                    size:'big',
                                    x:x,
                                    y:y,
                                    color:part[k].color,
                                    hint:'Это фигура'+k,
                                })
                                /*if(part[k].size == 'small') num+=8;
                                else if(part[k].size == 'medium') num+=10;
                                else if(part[k].size == 'big') num+=12;*/
                            }
                        }else{
                            for(var k=0, num = ((24*180)/(Math.PI*(radius+12*ply)))/2;k<part.length;k++, num += ((24*180)/(Math.PI*(radius+12*ply)))){
                                
                                if(num+4>partDegree){
                                    num=((24*180)/(Math.PI*(radius+16*ply)))/1.8;
                                    ply+=1;
                                }
                                if(24*ply > delta){
                                    data.circles[i].radius+=16;
                                    //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                                    return init();
                                }
                                if(ply>1){
                                    x=w/2+(radius+20*ply)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                    y=h/2+(radius+20*ply)*Math.cos((num+partDegree*p) * Math.PI / 180);
                                }else{
                                    x=w/2+(radius+14)*Math.sin((num+1+partDegree*p) * Math.PI / 180);
                                    y=h/2+(radius+14)*Math.cos((num+1+partDegree*p) * Math.PI / 180);
                                }
                                
                                star({
                                    n:part[k].n,
                                    size:'big',
                                    x:x,
                                    y:y,
                                    color:part[k].color,
                                    hint:'Это фигура'+k,
                                })
                                /*if(part[k].size == 'small') num+=8;
                                else if(part[k].size == 'medium') num+=10;
                                else if(part[k].size == 'big') num+=12;*/
                            }
                        }
                        /*
                        for(var k=0, num = ((24*180)/(Math.PI*(radius+12*ply)))/2;k<part.length;k++, num += ((24*180)/(Math.PI*(radius+12*ply)))){
                            if(i==0 && num>partDegree){
                                num=((12*180)/(Math.PI*(radius+16*ply)))/1.8;
                                if(k==0 && i==0) {
                                    num=partDegree/2;
                                }
                                ply+=1;
                                if(18*ply > delta){
                                    data.circles[i].radius+=18;
                                    //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                                    return init();
                                }
                            }
                            else if(num+4>partDegree){
                                num=((24*180)/(Math.PI*(radius+16*ply)))/1.8;
                                ply+=1;
                                if(18*ply > delta){
                                    data.circles[i].radius+=18;
                                    //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                                    return init();
                                }
                            }
                            if(i==0 && k==0){
                                x=w/2+(radius+16*ply)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                y=h/2+(radius+16*ply)*Math.cos((num+partDegree*p) * Math.PI / 180);
                            }else if(ply>1){
                                x=w/2+(radius+20*ply)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                y=h/2+(radius+20*ply)*Math.cos((num+partDegree*p) * Math.PI / 180);
                            }else{
                                x=w/2+(radius+12)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                y=h/2+(radius+12)*Math.cos((num+partDegree*p) * Math.PI / 180);
                            }
                            
                            star({
                                n:part[k].n,
                                size:'big',
                                x:x,
                                y:y,
                                color:part[k].color,
                                hint:'Это фигура'+k,
                            })
                            /*if(part[k].size == 'small') num+=8;
                            else if(part[k].size == 'medium') num+=10;
                            else if(part[k].size == 'big') num+=12;
                        }*/
                    }
                }
            }
            document.getElementById('myCanvas').addEventListener('mousemove',(e)=> {
                var yep = false;
                var x = e.clientX - leftOffset,
                    y = e.clientY - topOffset;
                ctx = getContext();
                for(var i = 0; i < shapes.length; i++){
                    yep = ctx.isPointInPath(shapes[i].path, x, y);
                    if(yep) break;
                }
                if (yep) {
                    document.getElementsByTagName('p')[0].innerText = shapes[i].hint;
                }else{
                    document.getElementsByTagName('p')[0].innerText = "Подсказка";
                }
            });
        </script>
    </body>
</html>