<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
            html, body{
                width:100%;
                display: flex;
                flex-direction: row;
            }
            canvas{
                background-color: whitesmoke;
            }
            #hint{
                border: blueviolet solid 2px;
                border-radius: 20px;
                text-align: center;
            }
        </style>
    </head>
    <body>
        <div>
            <canvas id="myCanvas" width=800 height=800>

            </canvas>
            <div id='hint'> 
                <p>
                    Подсказка
                </p>
            </div>
        </div>
        <script>
            var data = {
                parts:7 ,
                names:[
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                    'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum',
                ],
                circles:[
                    {
                        radius:50,
                        qr:[
                            [
                                {
                                    n:7,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"black",
                                },
                                {
                                    n:7,
                                    color:"blue",
                                },
                                {
                                    n:5,
                                    color:"red",
                                },
                                {
                                    n:9,
                                    color:"purple",
                                },
                                {
                                    n:5,
                                    color:"black",
                                },
                                {
                                    n:7,
                                    color:"blue",
                                },
                                {
                                    n:5,
                                    color:"red",
                                },
                                {
                                    n:9,
                                    color:"purple",
                                },
                            ],
                            [],
                            [],
                            [
                                {
                                    n:0,
                                    color:"red",
                                },
                            ],
                        ]
                    },
                    {
                        radius:100,
                        qr:[
                            [
                                {
                                    n:10,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"purple",
                                },
                                {
                                    n:6,
                                    color:"orange",
                                },
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                                {
                                    n:10,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"purple",
                                },
                                {
                                    n:6,
                                    color:"orange",
                                },
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                                
                                {
                                    n:16,
                                    color:"red",
                                },
                                {
                                    n:4,
                                    color:"orange",
                                },
                            ],
                            [
                                {
                                    n:9,
                                    color:"green",
                                },
                                {
                                    n:4,
                                    color:"green",
                                },
                                {
                                    n:3,
                                    color:"green",
                                },
                                {
                                    n:"23",
                                    color:"green",
                                },
                            ],
                            [   {
                                    n:"5",
                                    color:"green",
                                },
                                {
                                    n:6,
                                    color:"green",
                                },
                                {
                                    n:7,
                                    color:"green",
                                },
                                {
                                    n:8,
                                    color:"green",
                                },
                            ],
                            [
                                {
                                    n:33,
                                    color:"green",
                                },
                                {
                                    n:4,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"green",
                                },
                                {
                                    n:3,
                                    color:"green",
                                },
                            ],
                        ]
                    },
                    {
                        radius:150,
                        qr:[
                            [
                                {
                                    n:6,
                                    color:"green",
                                },
                                {
                                    n:5,
                                    color:"green",
                                }
                            ],
                            [],
                            [],
                            [
                                {
                                    n:4,
                                    color:"red",
                                },
                                {
                                    n:8,
                                    color:"green",
                                },
                                {
                                    n:8,
                                    color:"purple",
                                },
                                {
                                    n:5,
                                    color:"green",
                                },
                                {
                                    n:9,
                                    color:"green",
                                },
                                {
                                    n:6,
                                    color:"red",
                                },
                            ],
                            [

                            ],
                            [
                                {
                                    n:6,
                                    color:"yellow",
                                },
                            ],
                            [
                                {
                                    n:6,
                                    color:"red",
                                },
                            ]
                        ]
                    }
                ],
            };
            
            const getContext = () => document.getElementById('myCanvas').getContext('2d');
            
            var scale = 0.7;
            var shapes = [];
            var w=800, h =800;
            var leftOffset = document.getElementById('myCanvas').offsetLeft;
            var topOffset = document.getElementById('myCanvas').offsetTop;
            var ctx = getContext();

            const star = options =>{
                var starPath = new Path2D();
                if(options.size == 'small') r=4,R=8;
                else if(options.size == 'medium') r=5,R=10;
                else if(options.size == 'big') r=6,R=12;
                var ctx = getContext();
                if(options.color !== undefined) ctx.fillStyle = options.color;
                if(options.n != 0){
                    for(var i = 0,a = 0; i<2*options.n+1;i++,a += Math.PI / options.n){
                        var l = i % 2 == 0 ? r*scale : R*scale;
                        if(i==0){
                            starPath.moveTo(options.x + l * Math.cos(a),options.y + l * Math.sin(a));
                            continue;
                        }
                        starPath.lineTo(options.x + l * Math.cos(a),options.y + l * Math.sin(a));
                    };
                }else{
                    starPath.arc(options.x,options.y,r,0 * Math.PI, 2 * Math.PI)
                }
                //starPath.arc(options.x,options.y,R,0 * Math.PI, 2 * Math.PI)
                ctx.fill(starPath);
                shapes.push({
                    path:starPath,
                    hint:options.hint,
                });
                ctx.fillStyle = 'black';
            };
            var degrees = (len, rad)=>{
                return 360*len/(2*rad*Math.PI);
            }

            function wrapText(context, text, marginLeft, marginTop, maxWidth, lineHeight)
            {
                ctx.font = "1em serif";
                var words = text.split(" ");
                var countWords = words.length;
                var line = "";
                for (var n = 0; n < countWords; n++) {
                    var testLine = line + words[n] + " ";
                    var testWidth = context.measureText(testLine).width;
                    if (testWidth > 200) {
                        context.fillText(line, marginLeft, marginTop-50);
                        line = words[n] + " ";
                        marginTop += lineHeight;
                    }
                    else {
                        line = testLine;
                    }
                }
                //context.fillText(line, marginLeft, marginTop);
            }
            
            init();
            function init(){
                ctx.clearRect(0,0,w,h)
                shapes = [];
                ctx.beginPath();
                var partDegree = 360/data.parts;
                var alpha = (180-partDegree)/2;
                for(var i = 0; i < data.parts; i++){
                    ctx.moveTo(w/2,h/2);
                    ctx.lineTo(
                        w/2+(data.circles[data.circles.length-1].radius*scale+20)*Math.sin((partDegree*i) * Math.PI / 180),
                        h/2+(data.circles[data.circles.length-1].radius*scale+20)*Math.cos((partDegree*i) * Math.PI / 180)
                    );
                    if(data.names[i] !== undefined) {
                        x = w/2+(data.circles[data.circles.length-1].radius*scale+30)*Math.sin((partDegree*i+partDegree/2) * Math.PI / 180);
                        y = h/2+(data.circles[data.circles.length-1].radius*scale+30)*Math.cos((partDegree*i+partDegree/2) * Math.PI / 180);
                        //wrapText(getContext(), data.names[i], x,y,150,12)
                    }
                };
                ctx.stroke();
                for(var i = 0; i<data.circles.length; i++){
                    var circle = data.circles[i];
                    var radius = i==0?0:data.circles[i-1].radius*scale;
                    ctx.beginPath();
                    ctx.arc(w/2,h/2,circle.radius*scale,0 * Math.PI, 2 * Math.PI)
                    ctx.stroke();
                    if(i==0) var delta = circle.radius*scale;
                    else var delta = (circle.radius-data.circles[i-1].radius)*scale;
                    
                    for(var p = 0; p < data.parts; p++){
                        var part = circle.qr[p];
                        if(part === undefined) continue;
                        var ply = 1;
                        if(delta < 18){
                            data.circles[i].radius+=18*scale;
                            //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                            return init();
                        }
                        if(i==0 && data.parts !=4) ply=2;
                        for(var k=0, num = degrees(14, radius+24*ply);k<part.length;k++, num += degrees(26, radius+24*ply)){
                            if(k==0 && i==0) {
                                num=partDegree/2;
                            }
                            if(num+5>degrees(2*(radius+24*ply)*Math.cos(alpha* Math.PI / 180), radius+24*ply)){
                                num = degrees(14, radius+24*ply);
                                ply+=1;
                            }
                            if(24*ply > delta){
                                data.circles[i].radius+=22;
                                //alert('Не помещается, увеличиваю ' +i+'-й круг...')
                                return init();
                            }
                            /*if(k==0 ){
                                x=w/2+(radius+18*ply)*Math.sin((num+partDegree*p) * Math.PI / 180);
                                y=h/2+(radius+18*ply)*Math.cos((num+partDegree*p) * Math.PI / 180);
                            }else{*/
                                x=w/2+(radius+26*ply-12)*scale*Math.sin((num+partDegree*p) * Math.PI / 180);
                                y=h/2+(radius+26*ply-12)*scale*Math.cos((num+partDegree*p) * Math.PI / 180);
                            //}
                            star({
                                n:part[k].n,
                                size:'big',
                                x:x,
                                y:y,
                                color:part[k].color,
                                hint:'Это фигура'+k,
                            })
                        }
                    }
                }
            }

            document.getElementById('myCanvas').addEventListener('mousemove',(e)=> {
                var yep = false;
                var x = e.clientX - leftOffset,
                    y = e.clientY - topOffset;
                ctx = getContext();
                for(var i = 0; i < shapes.length; i++){
                    yep = ctx.isPointInPath(shapes[i].path, x, y);
                    if(yep) break;
                }
                if (yep) {
                    document.getElementsByTagName('p')[0].innerText = shapes[i].hint;
                }else{
                    document.getElementsByTagName('p')[0].innerText = "Подсказка";
                }
            });
        </script>
    </body>
</html>